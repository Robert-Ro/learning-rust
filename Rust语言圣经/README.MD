## 基础入门

### 基本类型

- 数值类型
  - 数值库：[num](https://crates.io/crates/num), 高质量的 Rust 数值库
- 字符、布尔、元类型
  - 字符类型 char：所有的 unicode 值都可以作为`Rust`字符, 表示方法：`'x'`
  - 布尔类型
  - 元类型：`()`, 发散函数：无法收敛的函数
- 语句和表达式
  语句会执行一些操作但是不会返回一个值，而表达式会在求值后返回一个值，**表达式总要返回值**
  - 语句
  - 表达式：会进行求值，然后返回一个值。
    - 调用一个函数
    - 调用宏
    - 用花括号包裹最终返回一个值的语句块
  - 函数
    - 函数名和变量名使用蛇形命名法(snake case)，例如`fn add_two() -> {}`
    - 函数的位置可以随便放，`Rust`不关心我们在哪里定义了函数，只要有定义即可
    - 每个函数参数都需要标注类型
    - Rust 中的特殊返回类型:
      - 无返回值()
      - 永不返回的函数!: 1)函数中抛出`panic!`, 2)函数中创建了无限循环

### 所有权和借用

内存安全几乎都是通过`GC`的方式实现，但是`GC`会引来性能、内存占用以及 Stop the world 等问题，在高性能场景和系统编程上是不可接受的，因此`Rust`采用了与(错)众(误)不(之)同(源)的方式：**所有权系统**。

#### 所有权

申请、释放资源三种流派：

- 垃圾回收机制：在程序运行时不断寻找不再使用的内存，典型代表：`Java`, `Go`
- 手动管理内存的分配和释放：通过函数调用的方式来申请和释放内存，典型代表：C++
- 通过所有权来管理内存：在编译时根据一系列规则进行检查(只在编译时进行检查，因此不对运行时有任何性能影响)

#### 堆和栈

- 写入方面：入栈比在堆上分配内存要快，因为入栈时操作系统无需分配新的空间，只需要将新数据放入栈顶即可。相比之下，**在堆上分配内存则需要更多的工作**，这是因为操作系统必须首先找到一块足够存放数据的内存空间，接着做一些记录为下一次分配做准备。

- 读取方面：得益于 CPU 高速缓存，使得处理器可以减少对内存的访问，高速缓存和内存的访问速度差异在 10 倍以上！**栈数据往往可以直接存储在 CPU 高速缓存中**，而**堆数据只能存储在内存中**。_访问堆上的数据比访问栈上的数据慢，因为必须先访问堆再通过堆上的指针来访问内存_。

#### 所有权原则

- Rust 中每一个值都**有且只有**一个所有者(变量)
- 当所有者(变量)**离开作用域范围时**，这个值将被丢弃(free)

##### String 类型

字符串字面值是很方便的，但是它并不适用于所有场景。原因有二：

- **字符串字面值是不可变的**，因为被硬编码到程序代码中
- 并非所有字符串的值都能在编写代码时得知

字符串字面值就完全无用武之地。 为此，`Rust`为我们提供动态字符串类型:`String`, 该类型**被分配到堆上**，因此**可以动态伸缩**，也就能**存储在编译时大小未知的文本**。
`String`类型是一个复杂类型，由存储在栈中的**堆指针**、**字符串长度**、**字符串容量**共同组成，其中堆指针是最重要的，它**指向了真实存储字符串内容的堆内存**，至于长度和容量，如果你有 Go 语言的经验，这里就很好理解：**容量是堆内存分配空间的大小**，**长度是目前已经使用的大小**.

- 拷贝`String`和存储在堆上的字节数组 如果该语句是拷贝所有数据(深拷贝)，那么无论是`String`本身还是底层的堆上数据，都会被全部拷贝，这对于性能而言会造成非常大的影响
- 只拷贝`String`本身 这样的拷贝非常快，因为在 64 位机器上就拷贝了 8 字节的指针、8 字节的长度、8 字节的容量，总计 24 字节，但是带来了新的问题，还记得我们之前提到的所有权规则吧？其中有一条就是，一个值只允许有一个所有者，而现在这个值(堆上的真实字符串数据)有了两个所有者：`s1`和`s2`。

##### 克隆(深拷贝)

确实需要深度复制`String`中堆上的数据，而不仅仅是栈上的数据，可以使用一个叫做`clone`的方法。

> 对于执行较为频繁的代码(热点路径)，使用 clone 会极大的降低程序性能，需要小心使用！

##### 拷贝(浅拷贝)

浅拷贝只发生在栈上，因此性能很高，在日常编程中，浅拷贝无处不在。

通用规则：任何基本类型的组合可以是 `Copy` 的，不需要分配内存或某种形式资源的类型是 `Copy` 的。如下是一些 `Copy` 的类型：

- 所有整数类型，比如 `u32`。
- 布尔类型，`bool`，它的值是 `true` 和 `false`。
- 所有浮点数类型，比如 `f64`。
- 字符类型，`char`。
- 元组，当且仅当其包含的类型也都是 `Copy` 的时候。比如，`(i32, i32)` 是 `Copy` 的，但 `(i32, String)` 就不是。

##### 函数传值与返回
